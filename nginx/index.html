<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>nginx socket指令</h1>
lingering_clsoe 制定如何保持客户端的链接，以便用于更多数据的传输
send_timeout 在两次成功的客户端接受相应的写操作之间设置一个超市时间
tcp_nodelay  用于keep-alive链接
tcp_nopush  依赖于sendfile的调用，使nginx在一个数据包中尝试发送响应头，以及在数据包中发送一个完整的文件。


location修饰符
= 使用精确匹配并且种植搜索
～区分大小写额度正则表达式匹配
～*不区分大小写的正则表达式匹配
^～ 如果该location是最佳皮皮饿，那么对匹配这个location的字符串不再见性正则表达式检测。注意这不是一个正则表达式匹配 它的目的是优先于正则表达式的匹配

nginx 反向代理的原理，nginx如何充当该角色。
最重要的是 proxy_pass指令，相关参数和配置。
与proxy紧密搭配的是upstream模块。
upstream指令将会启用一个新的配置区域，在该区域定义了一组上游服务器，这些服务器可以被设置为不同的权重（权重高的服务器将会被Nginx传递越多的连接）。

指令	说明
ip_hash	通过IP地址的哈希值确保客户端均匀地连接所有的服务器，键值基于C类地址
keepalive	每一个worker进程缓存的到上游服务器的连接数。再使用Http连接时，proxy_http_verison设置1.1，并将proxy_set_header设置为Connection “”
least_conn	激活负载均衡算法，将请求发送到活跃连接数最少的那台服务器
server	为upstream定义一个服务器地址（带有端口号的域名、IP地址，或者是UNIX套接字）和一个可选的参数，参数如下：weight：设置一个服务器的优先级优于其他服务器。max_fails：设置在fail_timeout时间之内尝试对一个服务器连接的最大次数，如果超过这个次数，那么就会被标记为down。fail_timeout：在这个指定的时间内服务器必须提供响应，如果在这个时间内没有收到响应，那么服务器就会被标记为down状态。backup：一旦其他服务器宕机，那么有该标记的机器就会接收请求。down：标记为一个服务器不再接受任何请求。
1.2.1. 负载均衡算法

upstream模块能够使用轮询、IP hash和最少连接数三种负载均衡算法之一来选择哪个上游服务器将会被在下一步中连接。

1.2.1.1. 轮询

默认情况使用轮询，不需要配置指令来设置，该算法选择下一个服务器，基于先前选择，再配置文件中哪一个是下一个服务器，以及每个服务器的负载。轮询算法是基于在队列中谁是下一个的原理确保将访问量均匀的分配给每一个上游服务器。

1.2.1.2. IP 哈希

通过ip_hash指令激活使用，从而将某些IP地址映射到同一个上游服务器。

1.2.1.3. 最少连接数

通过least_conn指令启用，该算法通过选择一个活跃的最少连接数服务器，然后将负载均匀分配给上游服务器。如果上游服务器的处理器能力不同，那么可以为server指令使用weight来指示说明。该算法将考虑到不同服务器的加权最小连接数。

2. Upstream服务器类型

上游服务器是Ngixn代理连接的一个服务器，可以是物理机或虚拟机。

2.1. 单个upstream服务器

指令try_files(包括http core模块内)意味着按顺序尝试，直到找到一个匹配为止。Nginx将会投递与客户端给定URI匹配的任何文件，如果没有找到任何配置文件，将会把请求代理到Apache作进一步处理。

2.2. 多个upstream服务器

Nginx将会通过轮询的方式将连续请求传递给3个上游服务器。这样应用程序不会过载。

这里写图片描述

3. 负载均衡特别说明

如果客户端希望总是访问同一个上游服务器，可以使用ip_hash指令；
如果请求响应时间长短不一，可以使用least_conn指令；
默认为轮询。


这个upstream 支持一组服务器，比如说多个apache主机，多个memcache主机，php-fpm服务器等等。
反向代理高级话题，升入研究使用nginx作为反向代理解决可伸缩及性能问题，
反向代理有助于安全。攻击者接触到反向代理，不能直接接触到应用服务器。
反向代理有助于扩展性。如果需要更强的处理能力，可以添加到由单个反向代理实现的上游服务器池子中。
反向代理有助于提升性能，一个应用程序的性能可以通过多种方式使用反向代理增强。反向代理能够缓存和压缩投递到客户端之前的内容。

</body>
</html>

